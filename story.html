<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ - ã¦ã‚‰ã“ã‚„å…¬å¼ã‚µã‚¤ãƒˆ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
        <div class="header-container">
            <h1 class="site-title">ğŸ« ã¦ã‚‰ã“ã‚„å…¬å¼ã‚µã‚¤ãƒˆ</h1>
            <nav>
                <ul class="nav-menu">
                    <li><a href="index.html">ãƒˆãƒƒãƒ—</a></li>
                    <li><a href="index.html#events">ã‚¤ãƒ™ãƒ³ãƒˆ</a></li>
                    <li><a href="story.html" class="active">ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main>
        <div class="container">
            <div class="story-container">
                <!-- ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="card" style="text-align: center; margin-bottom: 30px;">
                    <h1 style="color: #ff7b54; font-size: 2rem; margin-bottom: 15px;">
                        âœ¨ ã¦ã‚‰ã“ã‚„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ âœ¨
                    </h1>
                    <p style="color: #666; font-size: 1.1rem; line-height: 1.6;">
                        ãƒã‚¹ã‚³ãƒƒãƒˆã€Œã¦ã‚‰ã¡ã‚ƒã‚“ã€ã¨ä¸€ç·’ã«<br>
                        å­¦ã³ã¨æŒ‘æˆ¦ã®ç‰©èªã‚’èª­ã‚“ã§ã¿ã‚ˆã†ï¼
                    </p>
                </div>

                <!-- ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æœ¬ä½“ -->
                <div class="story-episode">
                    <h2 id="story-title">ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’èª­ã¿è¾¼ã¿ä¸­...</h2>
                    <div id="story-content" class="story-content">
                        ç‰©èªã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
                    </div>
                </div>

                <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                <div class="story-navigation">
                    <button id="next-story-btn" class="btn btn-primary" style="display: none;">
                        ğŸ“– æ¬¡ã®è©±ã‚’èª­ã‚€
                    </button>
                    <a href="index.html" id="home-btn" class="btn btn-secondary" style="display: none;">
                        ğŸ  ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹
                    </a>
                </div>

                <!-- é€²è¡ŒçŠ¶æ³ -->
                <div class="card" style="margin-top: 30px; text-align: center;">
                    <h3 style="color: #4facfe; margin-bottom: 15px;">ğŸ“Š èª­æ›¸ã®é€²è¡ŒçŠ¶æ³</h3>
                    <div style="background: #f8f9ff; border-radius: 15px; padding: 20px; margin-bottom: 15px;">
                        <p style="font-size: 1.1rem; font-weight: 500; color: #333;">
                            å…¨3è©±ã®ã†ã¡ <span id="story-progress" style="color: #ff7b54; font-weight: 700;">-</span> è©±èª­äº†
                        </p>
                        <div style="width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; margin: 15px 0;">
                            <div id="progress-bar" style="width: 0%; height: 100%; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 4px; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                    <p style="color: #666; font-size: 0.9rem;">
                        3è©±ã™ã¹ã¦èª­ã‚€ã¨ç‰¹åˆ¥ãªã”ã»ã†ã³ãŒã‚‚ã‚‰ãˆã‚‹ã‚ˆï¼
                    </p>
                </div>

                <!-- ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼ˆé–‹ç™ºç”¨ï¼‰ -->
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="resetStoryProgress()" class="btn" style="background: #6c757d; color: white; font-size: 0.8rem; padding: 8px 16px;">
                        ğŸ“ æœ€åˆã‹ã‚‰èª­ã¿ç›´ã™
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿
        const stories = [
            {
                title: "ç¬¬1è©±ï¼šã¦ã‚‰ã¡ã‚ƒã‚“ã®æ–°ã—ã„æŒ‘æˆ¦",
                content: "ã¦ã‚‰ã“ã‚„ã®ãƒã‚¹ã‚³ãƒƒãƒˆã€ã¦ã‚‰ã¡ã‚ƒã‚“ã¯ä»Šæ—¥ã‚‚å…ƒæ°—ã„ã£ã±ã„ï¼\nã€Œä»Šæ—¥ã¯æ–°ã—ã„ã“ã¨ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã‚ˆã†ï¼ã€\nã¦ã‚‰ã¡ã‚ƒã‚“ã¯ç©ºã‚’è¦‹ä¸Šã’ã¦ã€å¤§ããæ·±å‘¼å¸ã—ã¾ã—ãŸã€‚\nä½•ã‹ç´ æ•µãªå†’é™ºãŒå¾…ã£ã¦ã„ãã†ã§ã™ã€‚"
            },
            {
                title: "ç¬¬2è©±ï¼šã¡ã‚‡ã£ã¨ã—ãŸå¤±æ•—",
                content: "ã¦ã‚‰ã¡ã‚ƒã‚“ã¯ç´™é£›è¡Œæ©Ÿä½œã‚Šã«æŒ‘æˆ¦ã—ã¾ã—ãŸã€‚\nã§ã‚‚ã€ãªã‹ãªã‹ã†ã¾ãé£›ã³ã¾ã›ã‚“ã€‚\nã€Œã‚ã‚Œï¼Ÿã©ã†ã—ã¦ã†ã¾ãã„ã‹ãªã„ã®ã‹ãª...ã€\nã¡ã‚‡ã£ã´ã‚Šè½ã¡è¾¼ã‚“ã§ã—ã¾ã£ãŸã¦ã‚‰ã¡ã‚ƒã‚“ã§ã—ãŸã€‚"
            },
            {
                title: "ç¬¬3è©±ï¼šã¿ã‚“ãªã§å¿œæ´",
                content: "è½ã¡è¾¼ã‚€ã¦ã‚‰ã¡ã‚ƒã‚“ã‚’è¦‹ã¦ã€ã¦ã‚‰ã“ã‚„ã®ã¿ã‚“ãªãŒé›†ã¾ã£ã¦ãã¾ã—ãŸã€‚\nã€Œå¤§ä¸ˆå¤«ã ã‚ˆã€ã¦ã‚‰ã¡ã‚ƒã‚“ï¼ä¸€ç·’ã«ã‚„ã£ã¦ã¿ã‚ˆã†ï¼ã€\nã¿ã‚“ãªã§å”åŠ›ã—ã¦ã€ã¤ã„ã«ç´ æ•µãªç´™é£›è¡Œæ©ŸãŒå®Œæˆï¼\nã€Œã‚ã‚ŠãŒã¨ã†ã€ã¿ã‚“ãªï¼ã€ã¦ã‚‰ã¡ã‚ƒã‚“ã®ç¬‘é¡”ãŒæˆ»ã‚Šã¾ã—ãŸã€‚"
            }
        ];

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeStory();
            updateStoryProgress();
        });

        function initializeStory() {
            const currentStoryIndex = getFromStorage('terakoya_story_index', 0);
            
            if (currentStoryIndex >= stories.length) {
                showStoryComplete();
                return;
            }
            
            displayStory(currentStoryIndex);
        }

        function displayStory(index) {
            const story = stories[index];
            const titleEl = document.getElementById('story-title');
            const contentEl = document.getElementById('story-content');
            const nextBtn = document.getElementById('next-story-btn');
            const homeBtn = document.getElementById('home-btn');
            
            if (titleEl && contentEl) {
                titleEl.textContent = story.title;
                contentEl.innerHTML = story.content.replace(/\n/g, '<br>');
            }
            
            if (nextBtn) {
                nextBtn.style.display = index < stories.length - 1 ? 'inline-block' : 'none';
                nextBtn.onclick = () => nextStory(index);
            }
            
            if (homeBtn) {
                homeBtn.style.display = 'inline-block';
            }
        }

        function nextStory(currentIndex) {
            const nextIndex = currentIndex + 1;
            setToStorage('terakoya_story_index', nextIndex);
            
            if (nextIndex >= stories.length) {
                showStoryComplete();
            } else {
                displayStory(nextIndex);
            }
            updateStoryProgress();
        }

        function showStoryComplete() {
            const containerEl = document.querySelector('.story-container');
            if (!containerEl) return;
            
            containerEl.innerHTML = `
                <div class="story-episode">
                    <h2>ğŸ‰ å…¨éƒ¨èª­ã¿çµ‚ãˆã¾ã—ãŸï¼</h2>
                    <div class="story-content">
                        ç´ æ™´ã‚‰ã—ã„ï¼ã¦ã‚‰ã¡ã‚ƒã‚“ã®ç‰©èªã‚’å…¨éƒ¨èª­ã‚“ã§ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ï¼<br>
                        å›ã«ã‚‚ã€ãã£ã¨ç´ æ•µãªå†’é™ºãŒå¾…ã£ã¦ã„ã¾ã™ã€‚<br>
                        <br>
                        ç‰¹åˆ¥ãªã”ã»ã†ã³ãƒšãƒ¼ã‚¸ã«è¡Œã£ã¦ã¿ã‚ˆã†ï¼
                    </div>
                    <div class="story-navigation">
                        <a href="reward.html" class="btn btn-success">ã”ã»ã†ã³ãƒšãƒ¼ã‚¸ã¸</a>
                        <a href="index.html" class="btn btn-secondary">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</a>
                    </div>
                </div>
            `;
        }

        function resetStoryProgress() {
            setToStorage('terakoya_story_index', 0);
            location.reload();
        }

        function updateStoryProgress() {
            const currentIndex = getFromStorage('terakoya_story_index', 0);
            const totalStories = 3;
            const progressEl = document.getElementById('story-progress');
            const progressBarEl = document.getElementById('progress-bar');
            
            if (progressEl) {
                progressEl.textContent = Math.min(currentIndex, totalStories);
            }
            
            if (progressBarEl) {
                const progressPercent = Math.min((currentIndex / totalStories) * 100, 100);
                progressBarEl.style.width = progressPercent + '%';
            }
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function getFromStorage(key, defaultValue) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                return defaultValue;
            }
        }

        function setToStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.error('Error saving to localStorage:', e);
            }
        }
    </script>
</body>
</html>